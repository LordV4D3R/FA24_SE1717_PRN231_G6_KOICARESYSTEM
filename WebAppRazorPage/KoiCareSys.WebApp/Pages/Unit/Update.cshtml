@page "{id}"
@model KoiCareSys.WebApp.Pages.Unit.UpdateModel
@{
    ViewData["Title"] = "Update Unit";
}

<div class="container mt-5">
    <h2>Update Unit</h2>
    <form id="updateForm">
        <input type="hidden" asp-for="Unit.UnitId" />
        <div class="form-group">
            <label asp-for="Unit.Name"></label>
            <input asp-for="Unit.Name" class="form-control" />
            <span asp-validation-for="Unit.Name" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Unit.UnitOfMeasure"></label>
            <input asp-for="Unit.UnitOfMeasure" class="form-control" />
            <span asp-validation-for="Unit.UnitOfMeasure" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Unit.FullName"></label>
            <input asp-for="Unit.FullName" class="form-control" />
            <span asp-validation-for="Unit.FullName" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Unit.Information"></label>
            <textarea asp-for="Unit.Information" class="form-control"></textarea>
            <span asp-validation-for="Unit.Information" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Unit.MinValue"></label>
            <input asp-for="Unit.MinValue" type="number" class="form-control" />
            <span asp-validation-for="Unit.MinValue" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Unit.MaxValue"></label>
            <input asp-for="Unit.MaxValue" type="number" class="form-control" />
            <span asp-validation-for="Unit.MaxValue" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Unit.IdealValue"></label>
            <input asp-for="Unit.IdealValue" type="number" class="form-control" />
            <span asp-validation-for="Unit.IdealValue" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Unit.WarningThreshold"></label>
            <input asp-for="Unit.WarningThreshold" type="number" class="form-control" />
            <span asp-validation-for="Unit.WarningThreshold" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Unit.CriticalThreshold"></label>
            <input asp-for="Unit.CriticalThreshold" type="number" class="form-control" />
            <span asp-validation-for="Unit.CriticalThreshold" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Unit.IsActive"></label>
            <input asp-for="Unit.IsActive" type="checkbox" class="form-check-input" />
            <span asp-validation-for="Unit.IsActive" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Unit.Description"></label>
            <textarea asp-for="Unit.Description" class="form-control"></textarea>
            <span asp-validation-for="Unit.Description" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Unit.AlertMessage"></label>
            <textarea asp-for="Unit.AlertMessage" class="form-control"></textarea>
            <span asp-validation-for="Unit.AlertMessage" class="text-danger"></span>
        </div>
        <button type="submit" class="btn btn-primary">Update</button>
    </form>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            // Handle form submission
            $('#updateForm').on('submit', function (e) {
                e.preventDefault(); // Prevent default form submission

                const unitId = $('input[name="Unit.UnitId"]').val();
                const unitData = {
                    unitId: unitId,
                    name: $('input[name="Unit.Name"]').val(),
                    unitOfMeasure: $('input[name="Unit.UnitOfMeasure"]').val(),
                    fullName: $('input[name="Unit.FullName"]').val(),
                    information: $('textarea[name="Unit.Information"]').val(),
                    minValue: parseFloat($('input[name="Unit.MinValue"]').val()),
                    maxValue: parseFloat($('input[name="Unit.MaxValue"]').val()),
                    idealValue: parseFloat($('input[name="Unit.IdealValue"]').val()),
                    warningThreshold: parseFloat($('input[name="Unit.WarningThreshold"]').val()),
                    criticalThreshold: parseFloat($('input[name="Unit.CriticalThreshold"]').val()),
                    isActive: $('input[name="Unit.IsActive"]').is(':checked'),
                    description: $('textarea[name="Unit.Description"]').val(),
                    alertMessage: $('textarea[name="Unit.AlertMessage"]').val()
                };

                $.ajax({
                    url: `https://localhost:7050/api/Unit`,
                    type: 'PUT',
                    contentType: 'application/json',
                    data: JSON.stringify(unitData),
                    success: function () {
                        // Redirect to the unit page on success
                        window.location.href = '/Unit';
                    },
                    error: function (xhr, status, error) {
                        console.error('Error updating unit:', error);
                    }
                });
            });
        });
    </script>
}
